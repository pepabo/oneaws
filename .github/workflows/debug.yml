name: Debug bundler cache

on:
  pull_request:
  workflow_dispatch:

jobs:
  debug-cache:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Download bundler cache (restore only)
        uses: actions/cache/restore@v4
        with:
          path: ./cache
          key: setup-ruby-bundler-cache-v6-ubuntu-24.04-x64-ruby-3.4.3-wd-/home/runner/work/oneaws/oneaws-with--without--only--Gemfile.lock-36065e319b837aa77cd3b4c14c539ffdd8faf90b6849cdd0ada7543b3fc87f60
          restore-keys: |
            setup-ruby-bundler-cache-v6-ubuntu-24.04-x64-ruby-3.4.3-wd-/home/runner/work/oneaws/oneaws-with--without--only--Gemfile.lock-

      - name: List cache contents
        run: |
          echo "Cache directory contents:"
          ls -la ./cache || echo "Cache directory not found"
          echo ""
          echo "Recursive cache directory listing:"
          ls -laR ./cache || echo "Cache directory not found for recursive listing"
          echo ""
          find ./cache -type f -name "*.lock" 2>/dev/null || echo "No .lock files found"

      - name: Show current Gemfile.lock
        run: |
          echo "Current Gemfile.lock contents:"
          if [ -f Gemfile.lock ]; then
            cat Gemfile.lock
          else
            echo "Gemfile.lock not found in current directory"
          fi

      - name: Search for Gemfile.lock in cache
        run: |
          echo "Searching for Gemfile.lock in cache directory:"
          find ./cache -name "Gemfile.lock" -type f -exec echo "Found: {}" \; -exec cat {} \; 2>/dev/null || echo "No Gemfile.lock found in cache"
